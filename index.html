<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAR GROUNDS | Tactical FPS</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --military-green: #4b5320;
            --warn-orange: #ff8c00;
            --danger-red: #8b0000;
            --ui-text: #e0e0e0;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: #050505;
            font-family: 'Roboto Mono', monospace; color: var(--ui-text);
        }

        /* --- WEBSITE UI --- */
        #main-menu {
            position: absolute; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), 
                        url('https://images.unsplash.com/photo-1580234811497-9bd7fd2f357b?auto=format&fit=crop&w=1920&q=80');
            background-size: cover; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 1000;
            transition: opacity 0.8s ease;
        }

        h1 {
            font-family: 'Black Ops One', cursive; font-size: clamp(40px, 10vw, 100px);
            color: var(--warn-orange); margin: 0; letter-spacing: 5px;
            text-shadow: 4px 4px 10px rgba(0,0,0,0.8);
            text-align: center;
        }

        .btn-start {
            margin-top: 40px; padding: 20px 60px; font-size: 24px;
            font-family: 'Black Ops One', cursive; background: var(--military-green);
            color: white; border: none; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: 0.3s;
        }

        .btn-start:hover { background: #6b7330; transform: scale(1.05); }

        /* --- HUD --- */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 20px; display: none; justify-content: space-between;
            box-sizing: border-box; pointer-events: none; z-index: 100;
        }

        .hud-item {
            background: rgba(0,0,0,0.7); border: 2px solid var(--military-green);
            padding: 10px 20px; border-radius: 4px;
        }

        #health-bar {
            width: 200px; height: 10px; background: #222; margin-top: 10px;
        }

        #health-fill { width: 100%; height: 100%; background: var(--warn-orange); transition: 0.2s; }

        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px; border: 2px solid #00ff00;
            border-radius: 50%; transform: translate(-50%, -50%);
            display: none; pointer-events: none; z-index: 99;
        }

        #game-over {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); display: none;
            flex-direction: column; justify-content: center; align-items: center; z-index: 2000;
        }
    </style>
</head>
<body>

<div id="main-menu">
    <h1>WAR GROUNDS</h1>
    <p style="color: #aaa; letter-spacing: 2px;">SECTOR-7 DEPLOYMENT</p>
    <button class="btn-start" id="start-btn">INITIALIZE</button>
    <p style="margin-top: 20px; font-size: 14px;">[WASD] MOVE | [SPACE] JUMP | [MOUSE] FIRE</p>
</div>

<div id="hud">
    <div class="hud-item">SCORE: <span id="score-val" style="color: var(--warn-orange);">0</span></div>
    <div class="hud-item">
        STATUS: <span id="weapon-name">TACTICAL PISTOL</span>
        <div id="health-bar"><div id="health-fill"></div></div>
    </div>
</div>

<div id="crosshair"></div>

<div id="game-over">
    <h2 style="font-size: 80px; color: var(--danger-red); font-family: 'Black Ops One';">KIA</h2>
    <p>TOTAL SCORE: <span id="final-score">0</span></p>
    <button class="btn-start" onclick="location.reload()">RE-DEPLOY</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/PointerLockControls.js"></script>

<script>
    let scene, camera, renderer, controls, raycaster;
    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, canJump = false;
    let velocity = new THREE.Vector3(), direction = new THREE.Vector3();
    let prevTime = performance.now(), score = 0, health = 100, isGameOver = false;
    let enemies = [];
    
    const weapons = [
        { name: "TACTICAL PISTOL", rate: 250 },
        { name: "HEAVY RAILGUN", rate: 900 }
    ];
    let currentWeaponIndex = 0, lastShotTime = 0;

    const startBtn = document.getElementById('start-btn');
    const menu = document.getElementById('main-menu');
    const hud = document.getElementById('hud');
    const crosshair = document.getElementById('crosshair');

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0b10);
        scene.fog = new THREE.Fog(0x0a0b10, 0, 800);

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 2000);
        
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        controls = new THREE.PointerLockControls(camera, document.body);
        scene.add(controls.getObject());

        const ambient = new THREE.AmbientLight(0xffffff, 1.5); 
        scene.add(ambient);

        const sun = new THREE.DirectionalLight(0xffffff, 1.0);
        sun.position.set(100, 200, 100);
        scene.add(sun);

        const grid = new THREE.GridHelper(2000, 40, 0x4b5320, 0x111111);
        scene.add(grid);

        const groundGeo = new THREE.PlaneGeometry(2000, 2000);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x050505 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        raycaster = new THREE.Raycaster();

        startBtn.addEventListener('click', () => controls.lock());
        
        controls.addEventListener('lock', () => {
            menu.style.opacity = '0';
            setTimeout(() => { if(controls.isLocked) menu.style.display='none'; }, 500);
            hud.style.display = 'flex';
            crosshair.style.display = 'block';
        });

        controls.addEventListener('unlock', () => {
            if(!isGameOver) {
                menu.style.display = 'flex';
                setTimeout(() => menu.style.opacity = '1', 10);
            }
        });

        document.addEventListener('keydown', (e) => handleKey(e, true));
        document.addEventListener('keyup', (e) => handleKey(e, false));
        window.addEventListener('mousedown', shoot);
        window.addEventListener('wheel', switchWeapon);
        window.addEventListener('resize', onResize);

        animate();
    }

    function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function handleKey(e, val) {
        if (e.code === 'KeyW') moveForward = val;
        if (e.code === 'KeyS') moveBackward = val;
        if (e.code === 'KeyA') moveLeft = val;
        if (e.code === 'KeyD') moveRight = val;
        if (e.code === 'Space' && val && canJump) { velocity.y += 280; canJump = false; }
    }

    function switchWeapon() {
        currentWeaponIndex = (currentWeaponIndex + 1) % weapons.length;
        document.getElementById('weapon-name').innerText = weapons[currentWeaponIndex].name;
    }

    function spawnEnemy() {
        if(enemies.length > 15 || isGameOver) return;
        const geo = new THREE.BoxGeometry(16, 24, 16);
        const mat = new THREE.MeshStandardMaterial({ color: 0x222222, emissive: 0xff4400, emissiveIntensity: 0.5 });
        const enemy = new THREE.Mesh(geo, mat);
        const angle = Math.random() * Math.PI * 2;
        const dist = 400 + Math.random() * 200;
        enemy.position.set(Math.cos(angle)*dist, 12, Math.sin(angle)*dist);
        enemy.userData = { speed: 60 + Math.random() * 40 };
        scene.add(enemy);
        enemies.push(enemy);
    }

    function shoot() {
        if(!controls.isLocked || isGameOver) return;
        if(performance.now() - lastShotTime < weapons[currentWeaponIndex].rate) return;
        lastShotTime = performance.now();

        raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
        const hits = raycaster.intersectObjects(enemies);
        if(hits.length > 0) {
            const target = hits[0].object;
            scene.remove(target);
            enemies = enemies.filter(e => e !== target);
            score += 100;
            document.getElementById('score-val').innerText = score;
        }
    }

    function animate() {
        requestAnimationFrame(animate);
        const time = performance.now();
        const delta = (time - prevTime) / 1000;

        if (controls.isLocked && !isGameOver) {
            velocity.x -= velocity.x * 10.0 * delta;
            velocity.z -= velocity.z * 10.0 * delta;
            velocity.y -= 9.8 * 85.0 * delta;

            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveRight) - Number(moveLeft);
            direction.normalize();

            if (moveForward || moveBackward) velocity.z -= direction.z * 500.0 * delta;
            if (moveLeft || moveRight) velocity.x -= direction.x * 500.0 * delta;

            controls.moveRight(-velocity.x * delta);
            controls.moveForward(-velocity.z * delta);
            controls.getObject().position.y += (velocity.y * delta);

            if (controls.getObject().position.y < 12) {
                velocity.y = 0; controls.getObject().position.y = 12; canJump = true;
            }

            if(Math.random() < 0.04) spawnEnemy();

            enemies.forEach((enemy) => {
                const dir = new THREE.Vector3().subVectors(camera.position, enemy.position).normalize();
                enemy.position.x += dir.x * enemy.userData.speed * delta;
                enemy.position.z += dir.z * enemy.userData.speed * delta;
                if(enemy.position.distanceTo(camera.position) < 20) {
                    health -= 1;
                    document.getElementById('health-fill').style.width = health + "%";
                    if(health <= 0) {
                        isGameOver = true;
                        document.getElementById('game-over').style.display = 'flex';
                        document.getElementById('final-score').innerText = score;
                        controls.unlock();
                    }
                }
            });
        }
        renderer.render(scene, camera);
        prevTime = time;
    }
    init();
</script>
</body>
</html>