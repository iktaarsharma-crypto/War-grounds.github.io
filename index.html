<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WAR GROUNDS | OFFICIAL SITE</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --m-green: #4b5320; --orange: #ff8c00; --red: #8b0000; --neon: #00ff00; --dark: #0a0a0a; }
        
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--dark); font-family: 'Roboto Mono', monospace; color: white; }

        /* NAVIGATION */
        nav {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--m-green);
            display: flex; justify-content: space-around; align-items: center; z-index: 5000;
        }
        nav a {
            color: white; text-decoration: none; font-family: 'Black Ops One';
            font-size: 14px; letter-spacing: 1px; cursor: pointer; transition: 0.3s;
        }
        nav a:hover, nav a.active { color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        /* PAGE STRUCTURE */
        .page {
            position: absolute; top: 60px; left: 0; width: 100%; height: calc(100% - 60px);
            display: none; flex-direction: column; align-items: center; overflow-y: auto; padding: 20px;
        }
        .page.active { display: flex; }

        /* HOME & ABOUT STYLING */
        .content-card {
            max-width: 800px; width: 90%; background: #111; padding: 40px;
            border-left: 5px solid var(--m-green); margin-top: 40px;
            box-shadow: 10px 10px 0px var(--m-green);
        }
        h1 { font-family: 'Black Ops One'; color: var(--neon); font-size: 40px; }

        /* GAME SPECIFIC STYLES */
        #game-canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; display: none; }
        canvas { display: block; }
        .game-overlay { position: absolute; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        
        /* ORIENTATION WARNING */
        #orientation-warning {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: #fff; z-index: 10000;
            display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        @media screen and (orientation: portrait) { #orientation-warning { display: flex; } }

        /* HUD & UI */
        .screen { position: absolute; width: 100%; height: 100%; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 2000; background: rgba(0,0,0,0.9); pointer-events: auto; }
        .card { background: #111; padding: 30px; border: 2px solid var(--neon); width: 80%; max-width: 400px; text-align: center; pointer-events: auto; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid var(--m-green); color: var(--neon); }
        .btn { width: 100%; padding: 15px; margin-top: 10px; background: var(--m-green); color: white; border: none; font-family: 'Black Ops One'; font-size: 18px; cursor: pointer; }

        #hud { position: absolute; top: 70px; left: 0; width: 100%; padding: 20px; display: none; justify-content: space-between; pointer-events: none; z-index: 100; }
        .hud-box { background:rgba(0,0,0,0.8); color: var(--neon); padding:10px; border:1px solid var(--neon); }
        #hp-bar { width: 150px; height: 10px; background: #222; border: 1px solid var(--neon); margin-top:5px; }
        #hp-fill { width: 100%; height: 100%; background: var(--neon); }
        #mission-status { position: absolute; top: 150px; left: 20px; color: var(--orange); display: none; font-weight: bold; }

        #hotbar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: none; gap: 8px; z-index: 1000; pointer-events: auto; }
        .slot { width: 50px; height: 50px; background: rgba(0,0,0,0.8); border: 2px solid #333; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 8px; color: white; }
        .slot.active { border-color: var(--neon); background: rgba(0,255,0,0.1); }

        #mobile-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none; z-index: 500; }
        #joy-zone { position: absolute; bottom: 30px; left: 40px; width: 100px; height: 100px; border: 2px solid var(--neon); border-radius: 50%; pointer-events: auto; }
        #joy-knob { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: var(--neon); border-radius: 50%; opacity: 0.6; }
        .act-btn { position: absolute; border-radius: 50%; font-family: 'Black Ops One'; display: flex; justify-content: center; align-items: center; pointer-events: auto; color: white; }
        #btn-f { bottom: 30px; right: 40px; background: var(--red); width: 90px; height: 90px; }
        #btn-j { bottom: 130px; right: 55px; background: #444; width: 55px; height: 55px; }
        #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; border: 1px solid var(--neon); border-radius: 50%; transform: translate(-50%, -50%); display: none; }
    </style>
</head>
<body>

    <nav>
        <a onclick="showPage('home')" id="nav-home" class="active">HOME</a>
        <a onclick="showPage('game')" id="nav-game">GAME</a>
        <a onclick="showPage('about')" id="nav-about">ABOUT US</a>
    </nav>

    <div id="orientation-warning">
        <h1>ROTATE DEVICE</h1>
        <p>Landscape mode is required for combat operations.</p>
    </div>

    <div id="page-home" class="page active">
        <div class="content-card">
            <h1>WAR GROUNDS</h1>
            <p>Welcome to the front lines. This is a high-fidelity tactical simulation designed for mobile and desktop deployment.</p>
            <p style="color: var(--orange);">STATUS: ENLISTMENT OPEN</p>
            <button class="btn" onclick="showPage('game')">GO TO BATTLEFIELD</button>
        </div>
    </div>

    <div id="page-game" class="page">
        <div id="game-canvas-container"></div>
        
        <div id="auth-overlay" class="screen" style="display: flex;">
            <div class="card">
                <h2 style="font-family:'Black Ops One';">USER IDENTIFICATION</h2>
                <input type="email" id="email" placeholder="EMAIL">
                <input type="password" id="pass" placeholder="PASSWORD">
                <button class="btn" id="login-btn">LOGIN / REGISTER</button>
            </div>
        </div>

        <div id="menu-overlay" class="screen">
            <div class="card">
                <h2 id="user-name">OPERATOR</h2>
                <p id="best-score" style="color:var(--neon);"></p>
                <button class="btn" id="deploy-btn">DEPLOY MISSION</button>
            </div>
        </div>

        <div id="mission-status">MISSION: KILL <span id="target-count">0</span><br>KILLS: <span id="current-kills">0</span></div>
        <div id="crosshair"></div>
        <div id="hud">
            <div class="hud-box">SCORE: <span id="score-val">0</span><br>HP <div id="hp-bar"><div id="hp-fill"></div></div></div>
            <div class="hud-box" style="text-align:right;">LOADOUT: <span id="weap-name">RIFLE</span><br>AMMO: <span id="ammo-val">30</span></div>
        </div>

        <div id="hotbar">
            <div class="slot active" onclick="selectSlot(0)">1<span>RIFLE</span></div>
            <div class="slot" onclick="selectSlot(1)">2<span>PISTOL</span></div>
            <div class="slot" onclick="selectSlot(2)">3<span>SMG</span></div>
            <div class="slot" onclick="selectSlot(3)">4<span>MEDKIT</span></div>
            <div class="slot" onclick="selectSlot(4)">5<span>BOMB</span></div>
        </div>

        <div id="mobile-ui">
            <div id="joy-zone"><div id="joy-knob"></div></div>
            <div id="btn-f" class="act-btn">FIRE</div>
            <div id="btn-j" class="act-btn">JUMP</div>
        </div>

        <div id="game-over" class="screen">
            <h1 id="status-text" style="font-family:'Black Ops One';"></h1>
            <button class="btn" style="width:200px;" onclick="resetGame()">RE-DEPLOY</button>
        </div>
    </div>

    <div id="page-about" class="page">
        <div class="content-card">
            <h1>ABOUT THE PROJECT</h1>
            <p>War Grounds is a 3D WebGL experience built using Three.js. It features a procedural engine for textures and environments, allowing for fast loading on mobile devices.</p>
            <h3>TACTICAL INTEL:</h3>
            <ul>
                <li><strong>Combat:</strong> Use slots 1-3 for ballistics, 4 for healing, and 5 for area damage.</li>
                <li><strong>Missions:</strong> Every deployment generates a randomized kill-count objective.</li>
                <li><strong>Cross-Platform:</strong> Automatic joystick detection for touch devices.</li>
            </ul>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/PointerLockControls.js"></script>

<script>
    // NAVIGATION LOGIC
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        document.getElementById('nav-' + pageId).classList.add('active');
        
        if(pageId === 'game') {
            document.getElementById('game-canvas-container').style.display = 'block';
            if(!scene) initGame();
        } else {
            if(controls) controls.unlock();
        }
    }

    // GAME ENGINE
    let scene, camera, renderer, controls, raycaster;
    let moveF=0, moveB=0, moveL=0, moveR=0, canJump=false, velocity = new THREE.Vector3();
    let score=0, health=100, isGameOver=false, enemies=[], collidables=[], weapons = [];
    let ammo = [30, 15, 60, 2, 3], currentSlot = 0, recoilAmt = 0, prevTime = performance.now();
    let missionTarget = 0, kills = 0, currentUser = null;

    function genTex(c1, c2, mode) {
        const canv = document.createElement('canvas'); canv.width = canv.height = 256;
        const ctx = canv.getContext('2d'); ctx.fillStyle = c1; ctx.fillRect(0,0,256,256);
        ctx.fillStyle = c2;
        if(mode === 'camo') for(let i=0; i<30; i++) ctx.fillRect(Math.random()*256, Math.random()*256, 40, 40);
        else for(let i=0; i<256; i+=32){ ctx.fillRect(i,0,1,256); ctx.fillRect(0,i,256,1); }
        return new THREE.CanvasTexture(canv);
    }

    const camoTex = genTex('#2d3312', '#4b5320', 'camo');
    const enemyTex = genTex('#111', '#ff0000', 'camo');

    document.getElementById('login-btn').onclick = () => {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        if(!email || !pass) return;
        let db = JSON.parse(localStorage.getItem('wg_users')) || {};
        if(!db[email]) { db[email] = { password: pass, highScore: 0 }; localStorage.setItem('wg_users', JSON.stringify(db)); }
        else if(db[email].password !== pass) return alert("AUTH FAILED");
        currentUser = email;
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('menu-overlay').style.display = 'flex';
        document.getElementById('user-name').innerText = email.split('@')[0].toUpperCase();
        document.getElementById('best-score').innerText = "BEST: " + db[email].highScore;
    };

    function initGame() {
        scene = new THREE.Scene(); scene.background = new THREE.Color(0x020202);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('game-canvas-container').appendChild(renderer.domElement);
        
        controls = new THREE.PointerLockControls(camera, document.body);
        scene.add(controls.getObject()); controls.getObject().position.set(0, 12, 0);

        const floor = new THREE.Mesh(new THREE.PlaneGeometry(3000, 3000), new THREE.MeshStandardMaterial({map: genTex('#050505', '#111', 'grid')}));
        floor.rotation.x = -Math.PI/2; scene.add(floor);
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));

        // Props
        for(let i=0; i<60; i++) {
            const x=(Math.random()-0.5)*1500, z=(Math.random()-0.5)*1500;
            if(Math.abs(x)<100 && Math.abs(z)<100) continue;
            let m, r;
            if(Math.random()>0.5){
                m=new THREE.Mesh(new THREE.BoxGeometry(20,20,20), new THREE.MeshStandardMaterial({map: camoTex}));
                m.position.set(x,10,z); r=14;
            } else {
                m=new THREE.Mesh(new THREE.CylinderGeometry(2,2,80), new THREE.MeshStandardMaterial({color:0x222}));
                m.position.set(x,40,z); r=4;
            }
            scene.add(m); collidables.push({x, z, rad: r});
        }

        // Weapons loadout
        weaponContainer = new THREE.Group(); camera.add(weaponContainer);
        weapons.push(new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.4, 3), new THREE.MeshStandardMaterial({color:0x111})));
        weapons.push(new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.3, 1), new THREE.MeshStandardMaterial({color:0x111})));
        weapons.push(new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.3, 2), new THREE.MeshStandardMaterial({color:0x111})));
        weapons.push(new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.6, 0.6), new THREE.MeshStandardMaterial({color:0xfff})));
        weapons.push(new THREE.Mesh(new THREE.SphereGeometry(0.5, 8, 8), new THREE.MeshStandardMaterial({color:0x330})));
        weapons.forEach((w,i) => { w.position.set(1, -1, -2); w.visible=(i===0); weaponContainer.add(w); });

        raycaster = new THREE.Raycaster();

        document.getElementById('deploy-btn').onclick = () => {
            missionTarget = Math.floor(Math.random()*10)+5;
            document.getElementById('target-count').innerText = missionTarget;
            document.getElementById('menu-overlay').style.display='none';
            ['hud','hotbar','mission-status','crosshair'].forEach(id=>document.getElementById(id).style.display='flex');
            if('ontouchstart' in window) document.getElementById('mobile-ui').style.display='block';
            else controls.lock();
        };

        window.addEventListener('mousedown', () => { if(!isGameOver && document.getElementById('page-game').classList.contains('active')) shoot(); });
        setupMobile();
        animate();
    }

    function selectSlot(i) {
        currentSlot = i;
        weapons.forEach((w, idx) => w.visible = (idx === i));
        document.querySelectorAll('.slot').forEach((s, idx) => s.classList.toggle('active', idx === i));
        document.getElementById('weap-name').innerText = ["RIFLE", "PISTOL", "SMG", "MEDKIT", "BOMB"][i];
        document.getElementById('ammo-val').innerText = ammo[i];
    }

    function shoot() {
        if(ammo[currentSlot] <= 0) return;
        if(currentSlot === 3) { health=Math.min(100, health+30); ammo[3]--; document.getElementById('hp-fill').style.width=health+"%"; selectSlot(3); return; }
        if(currentSlot === 4) {
            ammo[4]--; selectSlot(4);
            enemies.forEach(e => { if(e.position.distanceTo(camera.position) < 200) { scene.remove(e); kills++; } });
            updateProgress(); return;
        }
        ammo[currentSlot]--; document.getElementById('ammo-val').innerText = ammo[currentSlot];
        recoilAmt = 0.3; raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
        const hits = raycaster.intersectObjects(enemies, true);
        if(hits.length > 0) {
            let hitObj = hits[0].object; while(hitObj.parent !== scene) hitObj = hitObj.parent;
            scene.remove(hitObj); enemies = enemies.filter(e => e !== hitObj);
            kills++; score += 100; updateProgress();
        }
    }

    function updateProgress() {
        document.getElementById('current-kills').innerText = kills;
        document.getElementById('score-val').innerText = score;
        if(kills >= missionTarget) endMatch(true);
    }

    function endMatch(success) {
        isGameOver = true; document.getElementById('game-over').style.display = 'flex';
        document.getElementById('status-text').innerText = success ? "MISSION SUCCESS" : "MISSION FAILED";
        document.getElementById('status-text').style.color = success ? "var(--neon)" : "var(--red)";
        let db = JSON.parse(localStorage.getItem('wg_users'));
        if(score > db[currentUser].highScore) { db[currentUser].highScore = score; localStorage.setItem('wg_users', JSON.stringify(db)); }
        controls.unlock();
    }

    function resetGame() { location.reload(); }

    function setupMobile() {
        const knob = document.getElementById('joy-knob'), zone = document.getElementById('joy-zone');
        zone.addEventListener('touchmove', (e) => {
            e.preventDefault(); const t=e.touches[0], r=zone.getBoundingClientRect();
            const dx=t.clientX-(r.left+50), dy=t.clientY-(r.top+50);
            const dist=Math.min(35, Math.sqrt(dx*dx+dy*dy)), ang=Math.atan2(dy, dx);
            knob.style.transform=`translate(${Math.cos(ang)*dist}px, ${Math.sin(ang)*dist}px)`;
            moveF=dy<-15?1:0; moveB=dy>15?1:0; moveL=dx<-15?1:0; moveR=dx>15?1:0;
        });
        zone.addEventListener('touchend', () => { knob.style.transform='none'; moveF=moveB=moveL=moveR=0; });
        let lx, ly;
        window.addEventListener('touchmove', (e) => {
            const t=e.touches[0]; if(t.clientX > window.innerWidth/2){
                if(lx){ camera.rotation.y-=(t.clientX-lx)*0.007; camera.rotation.x-=(t.clientY-ly)*0.007; }
                lx=t.clientX; ly=t.clientY;
            }
        });
        document.getElementById('btn-f').ontouchstart=(e)=>{ e.preventDefault(); shoot(); };
        document.getElementById('btn-j').ontouchstart=(e)=>{ e.preventDefault(); if(canJump){velocity.y+=250; canJump=false;} };
    }

    function animate() {
        requestAnimationFrame(animate);
        if(!isGameOver && currentUser && document.getElementById('page-game').classList.contains('active')) {
            const time = performance.now(), delta = (time-prevTime)/1000;
            velocity.x -= velocity.x * 10 * delta; velocity.z -= velocity.z * 10 * delta; velocity.y -= 9.8 * 80 * delta;
            if(moveF || moveB) velocity.z -= (moveF - moveB) * 800 * delta;
            if(moveL || moveR) velocity.x -= (moveL - moveR) * 800 * delta;
            controls.moveRight(-velocity.x * delta); controls.moveForward(-velocity.z * delta);
            const pos = controls.getObject().position;
            collidables.forEach(c => {
                const dx=pos.x-c.x, dz=pos.z-c.z, d=Math.sqrt(dx*dx+dz*dz);
                if(d < c.rad+7) { const a=Math.atan2(dz,dx); pos.x=c.x+Math.cos(a)*(c.rad+7); pos.z=c.z+Math.sin(a)*(c.rad+7); }
            });
            pos.y += velocity.y * delta; if(pos.y < 12) { pos.y = 12; velocity.y = 0; canJump = true; }
            weaponContainer.position.set(0, -recoilAmt, recoilAmt*2); recoilAmt *= 0.8;
            
            if(Math.random() < 0.01) {
                const group = new THREE.Group(); const mat = new THREE.MeshStandardMaterial({map: enemyTex});
                const b = new THREE.Mesh(new THREE.BoxGeometry(10, 16, 6), mat); b.position.y = 8;
                const h = new THREE.Mesh(new THREE.BoxGeometry(6, 6, 6), mat); h.position.y = 19;
                group.add(b, h); const a = Math.random() * Math.PI * 2;
                group.position.set(Math.cos(a)*800, 0, Math.sin(a)*800);
                scene.add(group); enemies.push(group);
            }
            enemies.forEach(e => {
                const v = new THREE.Vector3().subVectors(camera.position, e.position).normalize();
                e.position.x += v.x * 95 * delta; e.position.z += v.z * 95 * delta;
                e.lookAt(camera.position.x, 0, camera.position.z);
                if(e.position.distanceTo(camera.position) < 25) {
                    health -= 0.5; document.getElementById('hp-fill').style.width = health + "%";
                    if(health <= 0) endMatch(false);
                }
            });
            prevTime = time; renderer.render(scene, camera);
        }
    }
</script>
</body>
</html>
